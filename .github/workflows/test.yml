# .github/workflows/CI.yml

name: Code Coverage
on:
  push:
    branches: [main, master] # Adjust to your default branch
  pull_request:
    branches: [main, master] # Adjust to your default branch

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      # 1. Check out the repository
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Set up the Julia environment
      - name: Setup Julia
        uses: julia-actions/setup-julia@v2
        with:
          version: "1" # Use '1' for the latest stable 1.x release

      # 3. Install project dependencies
      - name: Instantiate project
        run: julia --project -e 'using Pkg; Pkg.instantiate()'

      # 4. Run tests and generate coverage files
      - name: Run tests
        run: julia --project -e 'using Pkg; Pkg.test(coverage=true)'

      # 5. Process coverage data
      # This step collects the .cov files and generates an lcov.info file
      - name: Process coverage
        uses: julia-actions/julia-processcoverage@v1

      # 6. Upload coverage report to Codecov
      - name: Upload to Codecov
        uses: codecov/codecov-action@v4
        with:
          # This token is set in your GitHub repository secrets
          token: ${{ secrets.CODECOV_TOKEN }}
          # The uploader will automatically find the lcov.info file
